{% extends 'base.html' %}

{% block title %}ãƒ•ãƒ¬ãƒ³ãƒ‰ - Moon Tasker{% endblock %}

{% block content %}
<h1 class="page-title">ãƒ•ãƒ¬ãƒ³ãƒ‰ ğŸŒ™</h1>

{% if is_logged_in %}
<!-- ãƒ­ã‚°ã‚¤ãƒ³ä¸­ -->
<div class="card" style="border-left: 4px solid #4caf50;">
    <div class="flex justify-between items-center">
        <div>
            <p class="text-sm text-muted">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</p>
            <p style="font-weight: 600;">{{ user_email }}</p>
        </div>
        <form action="/friends/logout" method="post">
            <button type="submit" class="btn btn-secondary" style="padding: 8px 16px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </form>
    </div>
</div>

<!-- ãƒã‚¤ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ -->
<div class="card text-center">
    <p class="text-muted text-sm mb-2">ã‚ãªãŸã®ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰</p>
    <p style="font-size: 28px; font-weight: 700; font-family: monospace; letter-spacing: 0.1em; color: #ffc107;">
        {{ my_friend_code or '--------' }}
    </p>
    <p class="text-xs text-muted mt-2">å‹é”ã«ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã—ã‚ˆã†ï¼</p>
</div>

<!-- ç”Ÿå‘½ä½“åŒæœŸ -->
<div class="card">
    <div class="flex justify-between items-center">
        <div>
            <h3 class="section-title" style="margin-bottom: 0;">ğŸ”„ ç”Ÿå‘½ä½“ã®åŒæœŸ</h3>
            <p class="text-muted text-sm">ãƒ•ãƒ¬ãƒ³ãƒ‰ã«è¦‹ã›ã‚‹ãŸã‚ã«åŒæœŸã—ã‚ˆã†</p>
        </div>
        <form action="/friends/sync-creature" method="post">
            <button type="submit" class="btn btn-primary" style="padding: 8px 16px;">åŒæœŸã™ã‚‹</button>
        </form>
    </div>
</div>

<!-- ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ  -->
<div class="card">
    <h3 class="section-title">â• ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’è¿½åŠ </h3>
    <form action="/friends/add" method="post" class="flex gap-2">
        <input type="text" name="friend_code" placeholder="ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ï¼‰" class="form-input"
            style="flex: 1; text-transform: uppercase;" maxlength="8">
        <button type="submit" class="btn btn-success">è¿½åŠ </button>
    </form>
</div>

<!-- ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§ -->
<div class="card">
    <h3 class="section-title">ğŸ‘¥ ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§</h3>

    {% if friends_list|length == 0 %}
    <div class="text-center" style="padding: 32px;">
        <span style="font-size: 48px;">ğŸŒ™</span>
        <p class="text-muted mt-4">ã¾ã ãƒ•ãƒ¬ãƒ³ãƒ‰ãŒã„ã¾ã›ã‚“</p>
        <p class="text-xs text-muted mt-2">ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’äº¤æ›ã—ã¦è¿½åŠ ã—ã‚ˆã†ï¼</p>
    </div>
    {% else %}
    {% for friend in friends_list %}
    <a href="/friends/{{ friend.id }}/creature" class="list-item" style="text-decoration: none; color: inherit;">
        <span style="font-size: 24px;">
            {% if friend.creature %}ğŸ°{% else %}ğŸ¥š{% endif %}
        </span>
        <div style="flex: 1;">
            <p style="font-weight: 500;">{{ friend.nickname or 'åç„¡ã—' }}</p>
            {% if friend.creature %}
            <p class="text-muted text-xs">Lv.{{ friend.creature.evolution_stage }} {{ friend.creature.name }}</p>
            {% endif %}
        </div>
        <span class="text-muted">â†’</span>
    </a>
    {% endfor %}
    {% endif %}
</div>

{% else %}
<!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="card">
    <h2 class="section-title">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
    <p class="text-muted text-sm mb-6">
        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ã€ãƒ•ãƒ¬ãƒ³ãƒ‰ã¨ç”Ÿå‘½ä½“ã‚’è¦‹ã›åˆãˆã¾ã™ï¼<br>
        ãƒ­ã‚°ã‚¤ãƒ³ãªã—ã§ã‚‚é€šå¸¸æ©Ÿèƒ½ã¯ä½¿ãˆã¾ã™ã€‚
    </p>

    <div id="login-error"></div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚¿ãƒ– -->
    <div class="flex gap-2 mb-4">
        <button onclick="showTab('login')" id="tab-login" class="btn btn-primary" style="flex: 1;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <button onclick="showTab('signup')" id="tab-signup" class="btn btn-secondary" style="flex: 1;">æ–°è¦ç™»éŒ²</button>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="form-login" action="/friends/login" method="post" hx-post="/friends/login" hx-target="#login-error"
        hx-swap="innerHTML">
        <div class="form-group mb-4">
            <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" name="email" placeholder="example@mail.com" required class="form-input">
        </div>
        <div class="form-group mb-4">
            <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" required class="form-input">
        </div>
        <button type="submit" class="btn btn-success w-full">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>

    <!-- æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="form-signup" action="/friends/signup" method="post" class="hidden" hx-post="/friends/signup"
        hx-target="#login-error" hx-swap="innerHTML">
        <div class="form-group mb-4">
            <label class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" name="nickname" placeholder="è¡¨ç¤ºå" class="form-input">
        </div>
        <div class="form-group mb-4">
            <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" name="email" placeholder="example@mail.com" required class="form-input">
        </div>
        <div class="form-group mb-4">
            <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰</label>
            <input type="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" required class="form-input">
        </div>
        <button type="submit" class="btn btn-success w-full">æ–°è¦ç™»éŒ²</button>
    </form>
</div>

<!-- ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰èª¬æ˜ -->
<div class="card" style="background: rgba(255, 193, 7, 0.1); border-color: rgba(255, 193, 7, 0.3);">
    <h3 class="section-title" style="color: #ffc107;">ğŸ’¡ ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã«ã¤ã„ã¦</h3>
    <p class="text-sm">
        ãƒ­ã‚°ã‚¤ãƒ³ãªã—ã§ã‚‚ã‚¢ãƒ—ãƒªã®å…¨æ©Ÿèƒ½ãŒä½¿ãˆã¾ã™ï¼<br>
        ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br><br>
        ãƒ•ãƒ¬ãƒ³ãƒ‰æ©Ÿèƒ½ã‚„ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½¿ã„ãŸã„å ´åˆã¯ã€<br>
        ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
    </p>
</div>

<script>
    function showTab(tab) {
        const loginForm = document.getElementById('form-login');
        const signupForm = document.getElementById('form-signup');
        const tabLogin = document.getElementById('tab-login');
        const tabSignup = document.getElementById('tab-signup');

        if (tab === 'login') {
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            tabLogin.className = 'btn btn-primary';
            tabSignup.className = 'btn btn-secondary';
        } else {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
            tabLogin.className = 'btn btn-secondary';
            tabSignup.className = 'btn btn-primary';
        }
    }
</script>
{% endif %}
{% endblock %}