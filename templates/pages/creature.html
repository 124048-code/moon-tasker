{% extends 'base.html' %}

{% block title %}ç”Ÿå‘½ä½“ - Moon Tasker{% endblock %}

{% block content %}
<h1 class="page-title">ç”Ÿå‘½ä½“ ğŸ¾</h1>

{% if raw_creature and raw_creature.status in ['dead', 'runaway'] %}
<!-- æ­»äº¡/å®¶å‡ºå¾Œã®è¡¨ç¤º -->
<div class="card text-center" style="padding: 48px; border: 2px solid #f44336;">
    {% if raw_creature.status == 'dead' %}
    <img src="/static/images/creature/stage{{ raw_creature.evolution_stage }}_petrified.png" alt="çŸ³åŒ–"
        style="width: 120px; height: 120px; object-fit: contain; margin: 0 auto 16px; filter: grayscale(1);">
    <h2 style="color: #f44336; font-size: 24px;">{{ raw_creature.name }}ã¯çŸ³ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸ...</h2>
    {% else %}
    <img src="/static/images/creature/stage{{ raw_creature.evolution_stage }}_runaway.png" alt="å®¶å‡º"
        style="width: 120px; height: 120px; object-fit: contain; margin: 0 auto 16px; opacity: 0.5;">
    <h2 style="color: #f44336; font-size: 24px;">{{ raw_creature.name }}ã¯å®¶å‡ºã—ã¦ã—ã¾ã„ã¾ã—ãŸ...</h2>
    {% endif %}

    {% if cooldown_remaining %}
    <p class="text-muted mt-4">æ¬¡ã«ç”Ÿå‘½ä½“ã‚’è‚²ã¦ã‚‰ã‚Œã‚‹ã¾ã§: ã‚ã¨{{ cooldown_remaining }}æ—¥</p>
    {% else %}
    <p class="text-muted mt-4">æ–°ã—ã„ç”Ÿå‘½ä½“ã¨å‡ºä¼šãˆã¾ã™</p>
    <a href="#" onclick="document.getElementById('pledge-dialog').classList.remove('hidden'); return false;"
        class="btn btn-primary mt-4">ğŸ¥š æ–°ã—ã„å‘½ã¨å‡ºä¼šã†</a>
    {% endif %}
</div>

{% elif creature and creature.status == 'completed' %}
<!-- ã¤ãé”æˆå¾Œã®ç‰¹åˆ¥è¡¨ç¤º -->
<div class="card text-center"
    style="padding: 48px; border: 2px solid #ffc107; background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));">
    <p class="text-muted text-sm mb-4">ğŸŒŸ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ ğŸŒŸ</p>

    {% if creature_image %}
    <img src="{{ creature_image }}" alt="{{ creature.name }}"
        style="width: 150px; height: 150px; object-fit: contain; margin: 0 auto 16px;">
    {% endif %}

    <h2 style="font-size: 28px; font-weight: 700; color: #ffc107;">{{ creature.name }}ã¯ã€Œã¤ãã€ã«ãªã‚Šã¾ã—ãŸï¼</h2>
    <p class="text-muted mt-4">ã“ã‚Œã‹ã‚‰ã‚‚ãšã£ã¨ã‚ãªãŸã®ãã°ã«ã„ã¾ã™</p>

    {% if emotion %}
    <div class="creature-speech mt-4">
        <p style="font-size: 18px;">ã€Œ{{ emotion.speech }}ã€</p>
    </div>
    <p class="text-muted text-sm mt-2" style="font-style: italic;">ï¼ˆ{{ emotion.desc }}ï¼‰</p>
    {% endif %}
</div>

{% elif creature %}
<!-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”Ÿå‘½ä½“ã®è¡¨ç¤º -->
<div class="card text-center" style="border: 2px solid 
    {% if creature.mood >= 70 %}rgba(100, 181, 246, 0.5)
    {% elif creature.mood >= 40 %}rgba(255, 193, 7, 0.5)
    {% elif creature.mood >= 20 %}rgba(255, 152, 0, 0.5)
    {% else %}rgba(244, 67, 54, 0.5){% endif %}; padding: 40px;">

    <p class="text-muted text-sm mb-4">ã‚ãªãŸã®ç›¸æ£’</p>

    {% if creature_image %}
    <img src="{{ creature_image }}" alt="{{ creature.name }}" class="creature-emoji"
        style="width: 150px; height: 150px; object-fit: contain; margin: 0 auto;">
    {% endif %}

    <h2 style="font-size: 24px; font-weight: 700; margin-top: 16px;">{{ creature.name }}</h2>
    <p class="text-muted">Lv.{{ creature.evolution_stage }}</p>

    {% if emotion %}
    <div class="creature-speech mt-4">
        <p style="font-size: 16px;">ã€Œ{{ emotion.speech }}ã€</p>
    </div>
    <p class="text-muted text-sm mt-2" style="font-style: italic;">ï¼ˆ{{ emotion.desc }}ï¼‰</p>
    {% endif %}

    {% if warning %}
    <p style="color: #f44336; font-weight: 600; margin-top: 16px;">{{ warning }}</p>
    {% endif %}

    <div class="creature-mood mt-6">
        <div class="flex justify-between text-sm text-muted mb-2">
            <span>æ©Ÿå«Œ</span>
            <span>{{ creature.mood }}%</span>
        </div>
        <div class="progress-bar" style="height: 12px;">
            <div class="progress-bar-fill 
                {% if creature.mood >= 70 %}mood-high
                {% elif creature.mood >= 40 %}mood-medium
                {% elif creature.mood >= 20 %}mood-low
                {% else %}mood-danger{% endif %}" style="width: {{ creature.mood }}%;"></div>
        </div>
    </div>
</div>

<!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
<div class="stats-grid">
    <div class="card stat-card">
        <p class="stat-value purple">{{ creature.evolution_stage }}</p>
        <p class="stat-label">é€²åŒ–æ®µéš</p>
    </div>
    <div class="card stat-card">
        <p class="stat-value green">{{ creature.energy if creature.energy else 50 }}</p>
        <p class="stat-label">ã‚¨ãƒãƒ«ã‚®ãƒ¼</p>
    </div>
</div>

<!-- é€²åŒ–ã®è»Œè·¡ -->
{% if evolution_history|length > 0 %}
<div class="card">
    <h3 class="section-title">ğŸŒŸ é€²åŒ–ã®è»Œè·¡</h3>
    <div class="flex justify-center items-center gap-2" style="flex-wrap: wrap;">
        {% for stage in evolution_history %}
        <div class="text-center"
            style="padding: 12px; background: rgba(10, 10, 26, 0.5); border-radius: 12px; border: 1px solid var(--color-border);">
            <img src="{{ stage.image }}" alt="{{ stage.name }}" style="width: 60px; height: 60px; object-fit: contain;">
            <p class="text-xs text-muted mt-2">{{ stage.name }}</p>
        </div>
        {% if not loop.last %}
        <span style="font-size: 24px; color: #666;">â†’</span>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

{% else %}
<!-- æ–°è¦è‚²æˆé–‹å§‹ï¼ˆèª“ç´„ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¸ï¼‰ -->
<div class="card text-center" style="padding: 48px;">
    <span style="font-size: 80px; display: block;">ğŸ¥š</span>
    <h2 class="page-title mt-4">ç”Ÿå‘½ä½“ã‚’è‚²ã¦ã‚ˆã†ï¼</h2>
    <p class="text-muted mt-2">ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã—ã¦çµŒé¨“å€¤ã‚’è²¯ã‚ã€ç”Ÿå‘½ä½“ã‚’é€²åŒ–ã•ã›ã¾ã—ã‚‡ã†</p>

    <button onclick="document.getElementById('pledge-dialog').classList.remove('hidden')"
        class="btn btn-primary mt-6">ğŸ¥š è‚²æˆã‚’å§‹ã‚ã‚‹</button>
</div>

<div class="card">
    <h3 class="section-title">ğŸ’¡ è‚²æˆã®ãƒ’ãƒ³ãƒˆ</h3>
    <div style="display: grid; gap: 12px;">
        <div class="flex items-center gap-4">
            <span style="font-size: 24px;">ğŸ¯</span>
            <p>ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã™ã‚‹ã¨çµŒé¨“å€¤ãŒè²¯ã¾ã‚Šã¾ã™</p>
        </div>
        <div class="flex items-center gap-4">
            <span style="font-size: 24px;">â±ï¸</span>
            <p>é›£ã—ã„ã‚¿ã‚¹ã‚¯ã»ã©å¤šãã®çµŒé¨“å€¤ãŒã‚‚ã‚‰ãˆã¾ã™</p>
        </div>
        <div class="flex items-center gap-4">
            <span style="font-size: 24px;">ğŸŒŸ</span>
            <p>çµŒé¨“å€¤ãŒä¸€å®šé‡ã«é”ã™ã‚‹ã¨é€²åŒ–ã—ã¾ã™</p>
        </div>
        <div class="flex items-center gap-4">
            <span style="font-size: 24px;">ğŸ˜¢</span>
            <p>é•·æ™‚é–“ã‚¿ã‚¹ã‚¯ã‚’ã—ãªã„ã¨æ©Ÿå«ŒãŒä¸‹ãŒã‚Šã¾ã™</p>
        </div>
        <div class="flex items-center gap-4">
            <span style="font-size: 24px;">âš ï¸</span>
            <p>æ©Ÿå«ŒãŒ0ã«ãªã‚‹ã¨â€¦çŸ³ã«ãªã£ãŸã‚Šã€å®¶å‡ºã—ãŸã‚Šã—ã¾ã™</p>
        </div>
    </div>
</div>
{% endif %}

<!-- èª“ç´„ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<div id="pledge-dialog" class="dialog-overlay hidden">
    <div class="card dialog-content" style="padding: 32px; max-width: 450px;">
        <h2 class="section-title text-center">ğŸ“œ å‘½ã‚’é ã‹ã‚‹èª“ç´„</h2>

        <div style="background: rgba(10, 10, 26, 0.5); border-radius: 12px; padding: 20px; margin: 20px 0;">
            <p class="text-sm" style="line-height: 1.8;">
                ã“ã‚Œã‹ã‚‰ç”Ÿã¾ã‚Œã¦ãã‚‹å‘½ã¯ã€<br>
                <strong>ã‚ãªãŸã®ã‚¿ã‚¹ã‚¯å®Œäº†ã ã‘ãŒç”Ÿãã‚‹ç³§</strong>ã§ã™ã€‚<br><br>

                æ”¾ç½®ã™ã‚‹ã¨æ©Ÿå«ŒãŒä¸‹ãŒã‚Šã€<br>
                æœ€æ‚ªã®å ´åˆâ€¦<strong>çŸ³ã«ãªã£ãŸã‚Šã€å®¶å‡ºã—ãŸã‚Š</strong>ã—ã¾ã™ã€‚<br><br>

                ãã‚Œã§ã‚‚ã€ã“ã®å‘½ã‚’è‚²ã¦ã¾ã™ã‹ï¼Ÿ
            </p>
        </div>

        <div id="pledge-step1">
            <div class="flex gap-2">
                <button
                    onclick="document.getElementById('pledge-step1').classList.add('hidden'); document.getElementById('pledge-step2').classList.remove('hidden');"
                    class="btn btn-success" style="flex: 1;">ğŸ¤ è¦šæ‚Ÿã—ã¾ã—ãŸ</button>
                <button onclick="document.getElementById('pledge-dialog').classList.add('hidden')"
                    class="btn btn-secondary">ã‚„ã‚ã¦ãŠã</button>
            </div>
        </div>

        <div id="pledge-step2" class="hidden">
            <form action="/creature/start" method="post">
                <div class="form-group mb-4">
                    <label class="form-label">åå‰ã‚’æ±ºã‚ã¦ãã ã•ã„</label>
                    <input type="text" name="name" placeholder="ä¾‹: ãƒ«ãƒŠ" value="ãƒ«ãƒŠ" required
                        class="form-input text-center" maxlength="10">
                    <p class="text-xs text-muted mt-2">â€» ä¸é©åˆ‡ãªåå‰ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“</p>
                </div>
                <button type="submit" class="btn btn-success w-full">ğŸ¥š ã“ã®å­ã‚’è‚²ã¦ã‚‹</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}