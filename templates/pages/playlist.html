{% extends 'base.html' %}

{% block title %}ã‚¿ã‚¹ã‚¯ç®¡ç† - Moon Tasker{% endblock %}

{% block content %}
<h1 class="page-title">ã‚¿ã‚¹ã‚¯ç®¡ç† ğŸ“</h1>

<!-- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆé¸æŠãƒ»ä½œæˆ -->
<div class="card">
    <h2 class="section-title">ğŸ“‹ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ</h2>

    <div class="flex gap-2 mb-4">
        <select id="playlist-select" class="form-select" style="flex: 1;"
            onchange="window.location.href='/playlist?selected=' + this.value">
            <option value="">ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’é¸æŠ...</option>
            {% for playlist in playlists %}
            <option value="{{ playlist.id }}" {% if selected_id==playlist.id %}selected{% endif %}>
                {{ playlist.name }}
            </option>
            {% endfor %}
        </select>

        {% if selected_id %}
        <form action="/playlist/{{ selected_id }}/delete" method="post">
            <button type="submit" onclick="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')" class="btn btn-danger"
                style="padding: 12px;">ğŸ—‘ï¸</button>
        </form>
        {% endif %}
    </div>

    <form action="/playlist/create" method="post" class="flex gap-2">
        <input type="text" name="name" placeholder="æ–°è¦ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå" class="form-input" style="flex: 1;">
        <button type="submit" class="btn btn-primary">â• ä½œæˆ</button>
    </form>
</div>

<!-- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã‚¿ã‚¹ã‚¯ -->
{% if selected_id %}
<div class="card">
    <h2 class="section-title">ğŸ“‹ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®å†…å®¹</h2>

    {% if selected_tasks|length == 0 %}
    <p class="text-muted">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
    {% else %}
    {% for task in selected_tasks %}
    <div class="list-item">
        <span class="text-muted" style="width: 24px;">{{ loop.index }}.</span>
        <span class="title">{{ task.title }}</span>
        <span class="meta">{{ task.duration }}åˆ†</span>
        <form action="/playlist/{{ selected_id }}/remove/{{ task.id }}" method="post" style="display: inline;">
            <button type="submit" class="action-btn" style="color: #ff9800;">âœ•</button>
        </form>
    </div>
    {% endfor %}
    {% endif %}
</div>
{% endif %}

<!-- ã‚¿ã‚¹ã‚¯ä½œæˆ -->
<div class="card">
    <h2 class="section-title">âœ¨ æ–°è¦ã‚¿ã‚¹ã‚¯ä½œæˆ</h2>

    <form action="/task/create" method="post">
        <input type="hidden" name="selected_playlist" value="{{ selected_id or '' }}">

        <div class="form-row mb-4">
            <div class="form-group">
                <input type="text" name="title" placeholder="ã‚¿ã‚¹ã‚¯å" required class="form-input">
            </div>
            <div class="form-group">
                <select name="difficulty" class="form-select">
                    <option value="1">â­ ç°¡å˜</option>
                    <option value="2" selected>â­â­ æ™®é€š</option>
                    <option value="3">â­â­â­ ä¸­ç¨‹åº¦</option>
                    <option value="4">â­â­â­â­ é›£ã—ã„</option>
                    <option value="5">â­â­â­â­â­ è¶…é›£</option>
                </select>
            </div>
        </div>

        <div class="form-row mb-4">
            <div class="form-group">
                <label class="form-label">ä½œæ¥­æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                <input type="number" name="duration" value="25" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                <input type="number" name="break_duration" value="5" class="form-input">
            </div>
        </div>

        <button type="submit" class="btn btn-primary">â• ã‚¿ã‚¹ã‚¯ä½œæˆ</button>
    </form>
</div>

<!-- åˆ©ç”¨å¯èƒ½ã‚¿ã‚¹ã‚¯ä¸€è¦§ -->
<div class="card">
    <h2 class="section-title">ğŸ“ åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯</h2>
    <p class="text-muted text-sm mb-4">ï¼‹ãƒœã‚¿ãƒ³ã§ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«è¿½åŠ </p>

    {% if pending_tasks|length == 0 %}
    <p class="text-muted">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</p>
    {% else %}
    {% for task in pending_tasks %}
    <div class="list-item">
        <span class="title">{{ task.title }}</span>
        <span class="meta">{{ task.duration }}åˆ† + {{ task.break_duration }}åˆ†ä¼‘æ†©</span>
        <div class="actions">
            {% if selected_id %}
            <form action="/playlist/{{ selected_id }}/add/{{ task.id }}" method="post" style="display: inline;">
                <button type="submit" class="action-btn" style="color: #4caf50; font-size: 18px;">â•</button>
            </form>
            {% endif %}
            <form action="/task/{{ task.id }}/delete" method="post" style="display: inline;">
                <button type="submit" onclick="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')" class="action-btn"
                    style="color: #f44336;">ğŸ—‘ï¸</button>
            </form>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>
{% endblock %}