{% extends 'base.html' %}

{% block title %}æ˜Ÿåº§å›³é‘‘ - Moon Tasker{% endblock %}

{% block content %}
<h1 class="page-title">æ˜Ÿåº§å›³é‘‘ â­</h1>
<p class="text-muted mb-6">ã‚¿ã‚¹ã‚¯ã‚’é”æˆã—ã¦ãƒãƒƒã‚¸ã‚’é›†ã‚ã‚ˆã†ï¼</p>

<!-- é€²æ— -->
<div class="card text-center mb-6">
    <p
        style="font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #ffc107, #ff9800); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        {{ unlocked_badges|length }} / {{ unlocked_badges|length + locked_badges|length }}
    </p>
    <p class="text-muted mt-2">ãƒãƒƒã‚¸ç²å¾—æ¸ˆã¿</p>

    <div class="progress-bar mt-4" style="max-width: 400px; margin: 16px auto 0;">
        {% set total = unlocked_badges|length + locked_badges|length %}
        {% set percent = (unlocked_badges|length / total * 100) if total > 0 else 0 %}
        <div class="progress-bar-fill gold" style="width: {{ percent }}%;"></div>
    </div>
</div>

<!-- ç²å¾—æ¸ˆã¿ãƒãƒƒã‚¸ -->
<div class="card">
    <h2 class="section-title" style="color: #ffc107;">ğŸ† ç²å¾—æ¸ˆã¿ãƒãƒƒã‚¸</h2>

    {% if unlocked_badges|length == 0 %}
    <div class="text-center" style="padding: 32px;">
        <span style="font-size: 48px;">ğŸ”’</span>
        <p class="text-muted mt-4">ã¾ã ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¦ã„ã¾ã›ã‚“</p>
        <p class="text-muted text-sm mt-2">ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã—ã¦ãƒãƒƒã‚¸ã‚’è§£é™¤ã—ã¾ã—ã‚‡ã†ï¼</p>
    </div>
    {% else %}
    <div class="badge-grid">
        {% for badge in unlocked_badges %}
        <div class="badge-card unlocked"
            onclick="showBadgeDetail('{{ badge.name }}', '{{ badge.constellation_name }}', '{{ badge.description }}', true)"
            style="cursor: pointer;">
            <span class="badge-icon">â­</span>
            <p class="badge-name">{{ badge.name }}</p>
            <p class="badge-desc" style="color: #ffc107;">{{ badge.constellation_name }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- æœªç²å¾—ãƒãƒƒã‚¸ -->
<div class="card">
    <h2 class="section-title text-muted">ğŸ”’ æœªç²å¾—ãƒãƒƒã‚¸</h2>

    {% if locked_badges|length == 0 %}
    <div class="text-center" style="padding: 32px;">
        <span style="font-size: 48px;">ğŸ‰</span>
        <p style="color: #4caf50; font-weight: 600; margin-top: 16px;">ã™ã¹ã¦ã®ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¾ã—ãŸï¼</p>
    </div>
    {% else %}
    <div class="badge-grid">
        {% for badge in locked_badges %}
        <div class="badge-card locked"
            onclick="showBadgeDetail('{{ badge.name }}', '{{ badge.constellation_name }}', '{{ badge.description }}', false)"
            style="cursor: pointer;">
            <span class="badge-icon" style="filter: grayscale(1);">ğŸŒŸ</span>
            <p class="badge-name">{{ badge.name }}</p>
            <p class="badge-desc">{{ badge.constellation_name }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- ãƒãƒƒã‚¸è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<div id="badge-detail-dialog" class="dialog-overlay hidden">
    <div class="card dialog-content text-center" style="padding: 32px; max-width: 400px;">
        <span id="badge-detail-icon" style="font-size: 64px; display: block; margin-bottom: 16px;"></span>
        <h2 id="badge-detail-name" class="section-title"></h2>
        <p id="badge-detail-constellation" style="color: #ffc107; margin-bottom: 16px;"></p>
        <p id="badge-detail-description" class="text-muted"></p>
        <div id="badge-detail-status" class="mt-4"></div>
        <button onclick="document.getElementById('badge-detail-dialog').classList.add('hidden')"
            class="btn btn-secondary mt-6">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
    function showBadgeDetail(name, constellation, description, unlocked) {
        document.getElementById('badge-detail-icon').textContent = unlocked ? 'â­' : 'ğŸŒŸ';
        document.getElementById('badge-detail-icon').style.filter = unlocked ? 'none' : 'grayscale(1)';
        document.getElementById('badge-detail-name').textContent = name;
        document.getElementById('badge-detail-constellation').textContent = constellation;
        document.getElementById('badge-detail-description').textContent = description;
        document.getElementById('badge-detail-status').innerHTML = unlocked
            ? '<span style="color: #4caf50;">âœ… ç²å¾—æ¸ˆã¿</span>'
            : '<span class="text-muted">ğŸ”’ æœªç²å¾—</span>';
        document.getElementById('badge-detail-dialog').classList.remove('hidden');
    }
</script>
{% endblock %}